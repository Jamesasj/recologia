#Plotando a função de fitness

rm(list=ls())
# Remove all objects from memory
# Function to output function to be integrated
INTEGRAND <- function(age,x,r) {
    Af <- 0;
    Bf <- 4*4 ;
    As <- 1 ;
    Bs <- 0.5 # parameter values
    return ((Af+Bf*x)*exp(-(As+Bs*x+r)*age)) # return function
}

# Function to integrate characteristic equation and return 1-its value
INTEGRAL <- function(r,x) {
    1-integrate(INTEGRAND,1,Inf,x,r)$value
}
                                        # 1-Characteristic equation
                                        # Function to find r given x

RCALC <- function(x) {
    uniroot(INTEGRAL, interval=c(1e-7,10),x)$root
}

# MAIN PROGRAM
x <- matrix(seq(0.5,3, length=100)) # x ranging from 0.5 to 3
length=100
# Calculate r for given x
r <- apply(x,1,RCALC)
plot(x,r,type="l",xlab="Body size, x",ylab="Fitness,r",las=1,lwd=4)

#####################################
## Achando o maximo com calculo
#####################################

#uniroot
rm(list=ls())
# Remove all objects from memory
# Function to calculate value of equation (2.41) for a given value of x
RFUNC <- function(x) {
    Af <- 0;
    Bf<-4*4;
    As<-1;
    Bs<-0.5
    # Set parameter values
    r <- Bs*(Af+Bf*x)/(Bf-Bs*Af-Bs*Bf*x)-Bs*x-As # r from eqn (2.40)
    return(log(Af+Bf*x)-(As+Bs*x+r)-log(As+Bs*x+r))
}
# MAIN PROGRAM
uniroot(f=RFUNC,interval=c(1.2,1.8))$root

#####################################
## Usando nlm
#####################################

RFUNC <- function(x) {
    Af<-0;
    Bf<-4*4;
    As<-1;
    Bs<-0.5
    # Set parameter values
    r <- Bs*(Af+Bf*x)/(Bf-Bs*Af-Bs*Bf*x)-Bs*x-As # r from eqn (2.40)
    return(abs(log(Af+Bf*x)-(As+Bs*x+r)-log(As+Bs*x+r)))
}
# MAIN PROGRAM
nlm(RFUNC, p=1.2)$estimate

#####################################
## Optimize
#####################################

optimize(f =RFUNC, interval = c(1.2,1.8),maximum= FALSE)$minimum

#####################################
## Usando métodos númericos
#####################################

rm(list1⁄4ls())
# Remove all objects from memory
# Function to get integral value
FUNC <- function(r,x)
{
Af <- 0; Bf <- 4*4 ; As <- 1 ;Bs <- 0.5 # parameter values
S <- exp(-(rþAsþBs*x))*(AfþBf*x)/(AsþBs*xþr) # Function value
return(1-S)
}

# Function to find r given x
RCALC <- function(x){uniroot( FUNC, interval1⁄4c(1e-07,10),x)
$root}
# MAIN PROGRAM
# Use optimize which allows us to constrain the search
# Tell optimize that we want the maximum
optimize(f 1⁄4 RCALC, interval 1⁄4 c(.5,3),maximum 1⁄4 TRUE)$maximum

#####################################
## Usando integração númerica
#####################################

rm(list1⁄4ls())
# Remove all objects from memory
# Function to do numerical integration of eqn (2.34)
INTEGRAND <- function(age,x,r)
{
Af <- 0; Bf <- 4*4 ; As <- 1 ;Bs <- 0.5
# parameter values
return ((AfþBf*x)*exp((AsþBs*xþr)*age)) # return function
}
# Function to integrate characteristic equation
FUNC <- function(r,x){1-integrate(INTEGRAND,1,Inf,x,r)$value}
# Function to find r given x
RCALC <- function(x){uniroot( FUNC, interval1⁄4c(1e-07,10),x)$root}
# MAIN PROGRAM
optimize(f 1⁄4 RCALC, interval 1⁄4 c(1.2,1.8),maximum 1⁄4 TRUE)$maximum
